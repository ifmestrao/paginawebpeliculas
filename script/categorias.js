// Datos extendidos de películas con géneros, directores y elenco
const moviesDataExtended = {
  24: {
    id: 24,
    title: "Jurassic World: El Renacer",
    year: 2025,
    poster: "imagenes/jurasic.jpg",
    rating: 6.1,
    quality: "Full HD Bluray",
    genres: ["Acción", "Aventura", "Ciencia ficción", "Suspenso"],
    director: "Gareth Edwards",
    cast: ["Scarlett Johansson", "Mahershala Ali", "Jonathan Bailey"]
  },
  23: {
    id: 23,
    title: "Capitán América: Un nuevo mundo",
    year: 2025,
    poster: "imagenes/captain-america.jpg",
    rating: 5.8,
    quality: "Full HD Bluray",
    genres: ["Acción", "Aventura", "Ciencia ficción"],
    director: "Julius Onah",
    cast: ["Anthony Mackie", "Harrison Ford", "Danny Ramirez"]
  },
  22: {
    id: 22,
    title: "Estado eléctrico",
    year: 2025,
    poster: "imagenes/electric.jpg",
    rating: 6.1,
    quality: "Full HD Bluray",
    genres: ["Acción", "Aventura"],
    director: "Anthony Russo, Joe Russo",
    cast: ["Chris Pratt", "Millie Bobby Brown", "Woody Harrelson"]
  },
  21: {
    id: 21,
    title: "Oni-Goroshi: Ciudad de los demonios",
    year: 2025,
    poster: "imagenes/oni.jpg",
    rating: 5.4,
    quality: "Full HD Bluray",
    genres: ["Acción", "Crimen", "Fantasía", "Suspenso"],
    director: "Seiji Tanaka",
    cast: ["Tôma Ikuta", "Masahiro Higashide", "Miou Tanaka"]
  },
  20: {
    id: 20,
    title: "El conjuro 4: Últimos ritos",
    year: 2025,
    poster: "imagenes/conjuro4.jpg",
    rating: 6.3,
    quality: "Full HD Bluray",
    genres: ["Terror", "Misterio", "Suspenso"],
    director: "Michael Chaves",
    cast: ["Patrick Wilson", "Vera Farmiga", "Mia Tomlinson"]
  },
  19: {
    id: 19,
    title: "La Liga de la Justicia de Zack Snyder",
    year: 2024,
    poster: "imagenes/ligadejusticia.webp",
    rating: 8.2,
    quality: "HD",
    genres: ["Acción", "Aventura", "Fantasía"],
    director: "Zack Snyder",
    cast: ["Ben Affleck", "Henry Cavill", "Amy Adams", "Gal Gadot"]
  },
  18: {
    id: 18,
    title: "Mufasa: El rey león",
    year: 2024,
    poster: "imagenes/mufasa.jpg",
    rating: 6.7,
    quality: "Full HD Bluray",
    genres: ["Aventura", "Animación", "Familiar", "Fantasía"],
    director: "Barry Jenkins",
    cast: ["Aaron Pierre", "Kelvin Harrison Jr.", "Tiffany Boone"]
  },
  17: {
    id: 17,
    title: "Kraven el cazador",
    year: 2024,
    poster: "imagenes/kraven.jpg",
    rating: 5.4,
    quality: "Full HD Bluray",
    genres: ["Acción", "Suspenso"],
    director: "J.C. Chandor",
    cast: ["Aaron Taylor-Johnson", "Ariana DeBose", "Fred Hechinger"]
  },
  16: {
    id: 16,
    title: "Lift: Un robo de primera clase",
    year: 2024,
    poster: "imagenes/lift.jpg",
    rating: 5.5,
    quality: "Full HD Bluray",
    genres: ["Acción", "Comedia", "Crimen", "Suspenso"],
    director: "F. Gary Gray",
    cast: ["Kevin Hart", "Gugu Mbatha-Raw", "Sam Worthington"]
  },
  15: {
    id: 15,
    title: "Bad Boys: Hasta la muerte",
    year: 2024,
    poster: "imagenes/bad.jpg",
    rating: 7.7,
    quality: "Full HD Bluray",
    genres: ["Acción", "Aventura", "Comedia"],
    director: "Adil El Arbi, Bilall Fallah",
    cast: ["Will Smith", "Martin Lawrence", "Vanessa Hudgens"]
  },
  14: {
    id: 14,
    title: "Oppenheimer",
    year: 2023,
    poster: "imagenes/oppenheimer.webp",
    rating: 8.4,
    quality: "Full HD Bluray",
    genres: ["Biografía", "Drama", "Historia"],
    director: "Christopher Nolan",
    cast: ["Cillian Murphy", "Emily Blunt", "Matt Damon"]
  },
  13: {
    id: 13,
    title: "Megalodón 2: El gran abismo",
    year: 2023,
    poster: "imagenes/megalodon2.webp",
    rating: 6.8,
    quality: "Full HD",
    genres: ["Acción", "Terror", "Ciencia ficción"],
    director: "Ben Wheatley",
    cast: ["Jason Statham", "Bingbing Li", "Rainn Wilson"]
  },
  12: {
    id: 12,
    title: "Indiana Jones y el llamado del destino",
    year: 2023,
    poster: "imagenes/indiana jones.webp",
    rating: 5.9,
    quality: "Full HD",
    genres: ["Acción", "Aventura", "Fantasía"],
    director: "James Mangold",
    cast: ["Harrison Ford", "Phoebe Waller-Bridge", "Mads Mikkelsen"]
  },
  11: {
    id: 11,
    title: "Drácula: El último viaje del Demeter",
    year: 2023,
    poster: "imagenes/Fantasma.webp",
    rating: 6.1,
    quality: "4K UHD",
    genres: ["Fantasía", "Terror"],
    director: "André Øvredal",
    cast: ["Corey Hawkins", "Aisling Franciosi", "Liam Cunningham"]
  },
  10: {
    id: 10,
    title: "Misión imposible: sentencia mortal",
    year: 2023,
    poster: "imagenes/mision imposible.webp",
    rating: 7.7,
    quality: "Full HD Bluray",
    genres: ["Acción", "Aventura", "Suspenso"],
    director: "Christopher McQuarries",
    cast: ["Tom Cruise", "Hayley Atwell", "Ving Rhames"]
  },
  9: {
    id: 9,
    title: "Implacable",
    year: 2023,
    poster: "imagenes/implacable.jpg",
    rating: 5.1,
    quality: "Full HD Bluray",
    genres: ["Acción", "Suspenso"],
    director: "Art Camacho",
    cast: ["Dermot Mulroney", "Jeff Fahey", "Mauricio Mendoza"]
  },
  8: {
    id: 8,
    title: "Pecadores",
    year: 2023,
    poster: "imagenes/sinners.jpg",
    rating: 7.0,
    quality: "Full HD Bluray",
    genres: ["Acción", "Drama", "Terror", "Suspenso"],
    director: "Ryan Coogler",
    cast: ["Michael B. Jordan", "Miles Caton", "Saul Williams"]
  },
  7: {
    id: 7,
    title: "Ferrari",
    year: 2023,
    poster: "imagenes/ferrari.jpg",
    rating: 6.5,
    quality: "Full HD",
    genres: ["Biografía", "Drama", "Historia"],
    director: "Michael Mann",
    cast: ["Adam Driver", "Shailene Woodley", "Giuseppe Festinese"]
  },
  6: {
    id: 6,
    title: "Halloween: La noche final",
    year: 2022,
    poster: "imagenes/halloween.jpg",
    rating: 5.0,
    quality: "Full HD",
    genres: ["Drama", "Terror", "Misterio", "Suspenso"],
    director: "David Gordon Green",
    cast: ["Jamie Lee Curtis", "Andi Matichak", "James Jude Courtney"]
  },
  5: {
    id: 5,
    title: "Tren bala",
    year: 2022,
    poster: "imagenes/bullet.jpg",
    rating: 7.3,
    quality: "Full HD",
    genres: ["Acción", "Comedia", "Suspenso"],
    director: "David Leitch",
    cast: ["Brad Pitt", "Joey King", "Aaron Taylor-Johnson"]
  },
  4: {
    id: 4,
    title: "Turno de día",
    year: 2022,
    poster: "imagenes/day.jpg",
    rating: 6.2,
    quality: "Full HD",
    genres: ["Acción", "Comedia", "Fantasía"],
    director: "J.J. Perry",
    cast: ["Jamie Foxx", "Dave Franco", "Natasha Liu Bordizzo"]
  },
  3: {
    id: 3,
    title: "Asesino sin memoria",
    year: 2022,
    poster: "imagenes/asesino.jpg",
    rating: 5.6,
    quality: "Full HD Bluray",
    genres: ["Acción", "Crimen", "Suspenso"],
    director: "Martin Campbell",
    cast: ["Liam Neeson", "Guy Pearce", "Taj Atwal"]
  },
  2: {
    id: 2,
    title: "Depredador: La Presa",
    year: 2022,
    poster: "imagenes/depredador.jpg",
    rating: 7.3,
    quality: "Full HD Bluray",
    genres: ["Acción", "Drama", "Terror"],
    director: "Dan Trachtenberg",
    cast: ["Amber Midthunder", "Dakota Beavers", "Dane DiLiegro"]
  },
  1: {
    id: 1,
    title: "Rápidos y furiosos 9",
    year: 2021,
    poster: "imagenes/f9.jpg",
    rating: 5.2,
    quality: "Full HD Bluray",
    genres: ["Acción", "Crimen", "Suspenso"],
    director: "Justin Lin",
    cast: ["Vin Diesel", "Michelle Rodriguez", "Jordana Brewster"]
  }
};

// Mapeo de categorías a géneros
const categoryMap = {
  'accion': ['Acción'],
  'comedia': ['Comedia'],
  'suspenso': ['Suspenso'],
  'aventura': ['Aventura'],
  'drama': ['Drama'],
  'crimen': ['Crimen'],
  'romance': ['Romance'],
  'terror': ['Terror'],
  'ciencia-ficcion': ['Ciencia ficción'],
  'destacado': ['Acción', 'Aventura', 'Ciencia ficción'] // Películas destacadas
};

// Descripciones de categorías
const categoryDescriptions = {
  /*
  'accion': 'Películas llenas de adrenalina, peleas espectaculares y emociones fuertes.',
  'comedia': 'Ríete con las mejores películas cómicas y situaciones hilarantes.',
  'suspenso': 'Tensión constante y giros inesperados que te mantendrán al borde del asiento.',
  'aventura': 'Viajes épicos, descubrimientos y emocionantes expediciones.',
  'drama': 'Historias profundas y emocionales que conectan con los sentimientos.',
  'crimen': 'Intrigas criminales, investigaciones y mundo del hampa.',
  'romance': 'Historias de amor, pasión y relaciones que tocan el corazón.',
  'terror': 'Peliculas de miedo que te harán saltar del susto.',
  'ciencia-ficcion': 'Futuros distópicos, tecnología avanzada y viajes espaciales.',
  'destacado': 'Las mejores películas seleccionadas especialmente para ti.'
  */
};

document.addEventListener('DOMContentLoaded', function() {
  loadCategoryMovies();
  setupMovieClickHandlers();
});

function loadCategoryMovies() {
  const urlParams = new URLSearchParams(window.location.search);
  const categoria = urlParams.get('categoria') || 'destacado';
  
  // Actualizar título y descripción
  const categoryTitle = document.getElementById('category-title');
  const categoryDescription = document.getElementById('category-description');
  
  const categoryName = getCategoryName(categoria);
  categoryTitle.textContent = `Películas de ${categoryName}`;
  categoryDescription.textContent = categoryDescriptions[categoria] || '';
  
  // Filtrar películas por categoría
  const filteredMovies = filterMoviesByCategory(categoria);
  
  // Mostrar películas
  displayCategoryMovies(filteredMovies);
}

// Variables de paginación para categorías
let currentCategoryPage = 1;
const moviesPerCategoryPage = 12;
let currentCategoryMovies = [];

document.addEventListener('DOMContentLoaded', function() {
  loadCategoryMovies();
  setupPagination();
  setupMovieClickHandlers();
});

function loadCategoryMovies() {
  const urlParams = new URLSearchParams(window.location.search);
  const categoria = urlParams.get('categoria') || 'destacado';
  
  // Actualizar título y descripción
  const categoryTitle = document.getElementById('category-title');
  const categoryDescription = document.getElementById('category-description');
  
  const categoryName = getCategoryName(categoria);
  categoryTitle.textContent = `Películas de ${categoryName}`;
  categoryDescription.textContent = categoryDescriptions[categoria] || '';
  
  // Filtrar películas por categoría
  currentCategoryMovies = filterMoviesByCategory(categoria);
  
  // Mostrar películas con paginación
  displayCategoryMovies(currentCategoryMovies);
  updatePaginationUI();
}

function displayCategoryMovies(movies) {
  const moviesGrid = document.getElementById('category-movies-grid');
  const startIndex = (currentCategoryPage - 1) * moviesPerCategoryPage;
  const endIndex = startIndex + moviesPerCategoryPage;
  const currentMovies = movies.slice(startIndex, endIndex);
  
  if (currentMovies.length === 0) {
    moviesGrid.innerHTML = `
      <div class="no-results">
        <i class="fas fa-film"></i>
        <h3>No hay películas en esta categoría</h3>
        <p>Próximamente agregaremos más contenido.</p>
      </div>
    `;
    // Ocultar paginación si no hay resultados
    document.querySelector('.pagination').style.display = 'none';
    return;
  }
  
  moviesGrid.innerHTML = currentMovies.map(movie => createMovieCard(movie)).join('');
  setupMovieClickHandlers();
  
  // Mostrar paginación solo si es necesaria
  const pagination = document.querySelector('.pagination');
  if (movies.length > moviesPerCategoryPage) {
    pagination.style.display = 'flex';
  } else {
    pagination.style.display = 'none';
  }
}

function setupPagination() {
  const prevBtn = document.querySelector('.pagination-btn.prev');
  const nextBtn = document.querySelector('.pagination-btn.next');
  
  if (prevBtn && nextBtn) {
    prevBtn.addEventListener('click', () => {
      if (currentCategoryPage > 1) {
        currentCategoryPage--;
        displayCategoryMovies(currentCategoryMovies);
        updatePaginationUI();
      }
    });
    
    nextBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(currentCategoryMovies.length / moviesPerCategoryPage);
      if (currentCategoryPage < totalPages) {
        currentCategoryPage++;
        displayCategoryMovies(currentCategoryMovies);
        updatePaginationUI();
      }
    });
  }
}

function updatePaginationUI() {
  const prevBtn = document.querySelector('.pagination-btn.prev');
  const nextBtn = document.querySelector('.pagination-btn.next');
  const currentPageSpan = document.querySelector('.current-page');
  const totalPagesSpan = document.querySelector('.total-pages');
  
  if (prevBtn && nextBtn && currentPageSpan && totalPagesSpan) {
    const totalPages = Math.ceil(currentCategoryMovies.length / moviesPerCategoryPage);
    
    prevBtn.disabled = currentCategoryPage === 1;
    nextBtn.disabled = currentCategoryPage === totalPages;
    currentPageSpan.textContent = currentCategoryPage;
    totalPagesSpan.textContent = totalPages;
    
    // Ocultar paginación si solo hay una página
    const pagination = document.querySelector('.pagination');
    if (totalPages <= 1) {
      pagination.style.display = 'none';
    } else {
      pagination.style.display = 'flex';
    }
  }
}

function getCategoryName(categoryKey) {
  const names = {
    'accion': 'Acción',
    'comedia': 'Comedia',
    'suspenso': 'Suspenso',
    'aventura': 'Aventura',
    'drama': 'Drama',
    'crimen': 'Crimen',
    'romance': 'Romance',
    'terror': 'Terror',
    'ciencia-ficcion': 'Ciencia Ficción',
    'destacado': 'Destacadas'
  };
  return names[categoryKey] || 'Películas';
}

function filterMoviesByCategory(category) {
  const targetGenres = categoryMap[category] || [];
  
  return Object.values(moviesDataExtended).filter(movie => {
    return targetGenres.some(genre => 
      movie.genres.some(movieGenre => 
        movieGenre.toLowerCase().includes(genre.toLowerCase())
      )
    );
  });
}

function displayCategoryMovies(movies) {
  const moviesGrid = document.getElementById('category-movies-grid');
  
  if (movies.length === 0) {
    moviesGrid.innerHTML = `
      <div class="no-results">
        <i class="fas fa-film"></i>
        <h3>No hay películas en esta categoría</h3>
        <p>Próximamente agregaremos más contenido.</p>
      </div>
    `;
    return;
  }
  
  moviesGrid.innerHTML = movies.map(movie => createMovieCard(movie)).join('');
  setupMovieClickHandlers();
}

function createMovieCard(movie) {
  return `
    <div class="movie-card" data-id="${movie.id}">
      <div class="movie-poster">
        <img src="${movie.poster}" alt="${movie.title}">
        <div class="movie-quality">${movie.quality}</div>
        <div class="movie-overlay">
          <div class="play-button">
            <i class="fas fa-play"></i>
          </div>
        </div>
      </div>
      <div class="movie-info">
        <h3 class="movie-title">${movie.title}</h3>
        <div class="movie-meta">
          <div class="movie-year">
            <i class="far fa-calendar-alt"></i> ${movie.year}
          </div>
          <div class="movie-rating">
            <i class="fas fa-star"></i> ${movie.rating}
          </div>
        </div>
      </div>
    </div>
  `;
}

function setupMovieClickHandlers() {
  const movieCards = document.querySelectorAll('.movie-card');
  
  movieCards.forEach(card => {
    card.addEventListener('click', function() {
      const movieId = this.dataset.id;
      window.location.href = `pelidetalle.html?id=${movieId}`;
    });
  });
}

// Configurar búsqueda
function setupSearch() {
  const searchForm = document.getElementById('search-form');
  const searchInput = document.getElementById('search-input');
  
  searchForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const query = searchInput.value.trim().toLowerCase();
    
    if (query) {
      const searchResults = Object.values(moviesDataExtended).filter(movie => 
        movie.title.toLowerCase().includes(query) ||
        movie.director.toLowerCase().includes(query) ||
        movie.cast.some(actor => actor.toLowerCase().includes(query)) ||
        movie.genres.some(genre => genre.toLowerCase().includes(query))
      );
      
      displaySearchResults(searchResults, query);
    }
  });
}

function displaySearchResults(results, query) {
  const categoryTitle = document.getElementById('category-title');
  const categoryDescription = document.getElementById('category-description');
  const moviesGrid = document.getElementById('category-movies-grid');
  
  categoryTitle.textContent = `Resultados de: "${query}"`;
  categoryDescription.textContent = `${results.length} película${results.length !== 1 ? 's' : ''} encontrada${results.length !== 1 ? 's' : ''}`;
  
  if (results.length > 0) {
    moviesGrid.innerHTML = results.map(movie => createMovieCard(movie)).join('');
  } else {
    moviesGrid.innerHTML = `
      <div class="no-results">
        <i class="fas fa-search"></i>
        <h3>No se encontraron resultados</h3>
        <p>Intenta con otros términos de búsqueda.</p>
      </div>
    `;
  }
  
  setupMovieClickHandlers();
}

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
  setupSearch();
});